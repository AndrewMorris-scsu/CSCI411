CREATE OR REPLACE PROCEDURE pay (perid in INTEGER, buy_pid in INTEGER)
AS 
bookwriter integer;
book integer;
checkp integer;
payed integer;
amount real;
BEGIN
  SELECT P.perid INTO bookwriter
  FROM Persons P, Authors A
  WHERE P.perid = A.perid
  IF bookwriter is NOT NULL THEN
   DBMS_OUPUT.PUT_LINE('The Author does not need to pay allow');
   EXIT;
  ELSE IF bookwriter is NULL THEN
  	SELECT MAX(p.pid) INTO book
  	FROM Publications p
  	WHERE p.pid = buy_pid;
  	IF book IS NULL then
    		DBMS_OUTPUT.PUT_LINE('The book does not exist');
  	ELSE
    		DBMS_OUTPUT.PUT_LINE('Value inserted successfully');
    		SELECT MAX(C.perid) Into checkp
  		FROM Customer C
  		WHERE  C.perid = perid;
  			IF checkp is NULL then
    				DBMS_OUTPUT.PUT_LINE('The person does not exist');
  			ELSE
    				DBMS_OUTPUT.PUT_LINE('Value inserted successfully'); 
  				SELECT F.perid INTO payed
  				FROM Paysfor F
  				WHERE F.perid = perid AND F.pid = buy_pid;
  				IF payed is NULL then
  					SELECT P.price INTO amount
  				FROM Publications P
  				WHERE P.price = amount;
  				INSERT INTO Paysfor (checkp,buy_pid,amount) Values (perid,pid, cost);
				END IF;
			END IF;
		END IF;
	END IF;
END IF;
END;





